<!DOCTYPE html>
<head>
  <title>Upload Journey</title>
  {% load static %}
  <link rel="stylesheet" type="text/css" href="{% static '/tracex/css/loading-spinner.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static '/tracex/css/style.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static '/tracex/css/progress-bar.css' %}">
  <script src="{% static '/tracex/js/progress-bar.js' %}" defer></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  {% csrf_token %}
  <style>
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="main_body">
  {% if is_comparing %}
    <img src="{% static '/tracex/img/extraction_logo.png' %}" alt="Extraction Logo" class="extraction_logo">
    <h2>Execute Extraction Pipeline</h2>
    <p>Click the "Execute Extraction Pipeline" button below to start the extraction process.</p>
    <p>You can monitor the progress and see which modules are currently running in the progress bar that appears. The progress bar will keep you informed about the status of the extraction pipeline from start to finish.</p>
  {% else %}
    <img src="{% static '/tracex/img/extraction_logo.png' %}" alt="Extraction Logo" class="extraction_logo">
    <h2>Prepare Extraction Pipeline</h2>
    <p>Here you can set what parts of the pipeline should be run, what should be visibile in the output and how the output is shown.</p>
  {% endif %}

  <form method="post" enctype="multipart/form-data" id="filter_form">
    {% csrf_token %}
    <div class="form-row {% if is_comparing %}hidden{% endif %}">
      <div class="form-column">
        <h4>Pipeline modules to run</h4>
        {{ form.modules_required.label_tag }}
        {{ form.modules_required }}
        {{ form.modules_required.errors }}
        <br>
        {{ form.modules_optional.label_tag }}
        {{ form.modules_optional }}
        {{ form.modules_optional.errors }}
      </div>
      <div class="form-column" style="flex: 2;">
        <h4>Output filters</h4>
        <div class="form-row" style="display: flex; justify-content: space-between;">
          <div class="form-column" style="flex: 1;">
            {{ form.event_types.label_tag }}
            {{ form.event_types }}
            {{ form.event_types.errors }}
          </div>
          <div class="form-column" style="flex: 1;">
            {{ form.locations.label_tag }}
            {{ form.locations }}
            {{ form.locations.errors }}
          </div>
        </div>
      </div>
      <div class="form-column activity-key-column">
        <h4>DFG activity key</h4>
        {{ form.activity_key.label_tag }}
        {{ form.activity_key }}
        {{ form.activity_key.errors }}
      </div>
      <style>
        .activity-key-column label, .activity-key-column select {
            display: block;
        }
      </style>
    </div>
    {% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <div class="spinner-container" id="loading-container">
      <span id="loading-spinner" class="loader not_visible"></span>
    </div>
    <div id="progress_box" class="not_visible">
      <div class="progress-container">
        <!-- Progress bar and message will be added here -->
      </div>
    </div>
    <input type="submit" value="Execute Extraction Pipeline" id="progress_button" class="button">
  </form>

  <a href="{{ request.META.HTTP_REFERER }}">
    <button class="menu_button">Previous</button>
  </a>
  <a href="{% url 'landing_page' %}">
    <button class="menu_button">Return to TracEX menu</button>
  </a>
</body>
